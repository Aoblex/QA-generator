[
    {
        "strategy": "subsection",
        "source": "deeplearning",
        "title": "11.5.4.1 Metropolis-Hastings 算法",
        "content_length": 3824,
        "content": "Title: 11.5.4.1 Metropolis-Hastings 算法\nContent:\nMetropolis-Hastings 算法, 简称MH 算法, 是一种应用广泛的 MCMC 方法.假设马尔可夫链的状态转移分布 (即提议分布) $q\\left(\\boldsymbol{x} \\mid \\boldsymbol{x}^{\\prime}\\right)$ 为一个比较容易采样的分布, 其平稳分布往往不是 $p(\\boldsymbol{x})$. 为此, $\\mathrm{MH}$ 算法引入拒绝采样的思想来修正提议分布,使得最终采样的分布为 $p(\\boldsymbol{x})$.\n\n在 $\\mathrm{MH}$ 算法中, 假设第 $t$ 次采样的样本为 $\\boldsymbol{x}_{t}$, 首先根据提议分布 $q\\left(\\boldsymbol{x} \\mid \\boldsymbol{x}_{t}\\right)$ 抽取一个样本 $\\hat{\\boldsymbol{x}}$, 并以概率 $A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)$ 来接受 $\\hat{\\boldsymbol{x}}$ 作为第 $t+1$ 次的采样样本 $\\boldsymbol{x}_{t+1}$,\n\n\n\\begin{equation*}\nA\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)=\\min \\left(1, \\frac{p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right)}{p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right)}\\right) . \\tag{11.107}\n\\end{equation*}\n\n\nMH 算法的采样过程如算法11.3所示.\n\n在 $\\mathrm{MH}$ 算法中, 因为每次 $q\\left(\\boldsymbol{x} \\mid \\boldsymbol{x}_{t}\\right)$ 随机生成一个样本 $\\hat{\\boldsymbol{x}}$, 并以概率 $A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)$ 的方式接受, 所以修正的马尔可夫链状态转移概率为\n\n\n\\begin{equation*}\nq^{\\prime}\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right)=q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right) A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right), \\tag{11.108}\n\\end{equation*}\n\n\n\\href{https://nndl.github.io/}{https://nndl.github.io/}\n\n\\section*{算法 11.3 Metropolis-Hastings算法的采样过程}\n输入: 提议分布 $q\\left(\\boldsymbol{x} \\mid \\boldsymbol{x}^{\\prime}\\right)$,采样间隔 $M$,样本集合 $\\mathcal{V}=\\varnothing$;\n\n1 随机初始化 $x_{0}, t=0$;\n\n2 repeat\n\n\\section*{// 预热过程}\n根据 $q\\left(\\boldsymbol{x} \\mid \\boldsymbol{x}_{t}\\right)$ 随机生成一个样本 $\\hat{\\boldsymbol{x}}$;\n\n计算接受概率 $A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)$;\n\n从 $(0,1)$ 的均匀分布中随机生成一个值 $z$;\n\nif $z \\leq A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)$ then // 以 $A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)$ 的概率接受 $\\hat{\\boldsymbol{x}}$\n\n$x_{t+1}=\\hat{x}$\n\n\n\n$x_{t+1}=x_{t}$\n\nend\n\n$t++$;\n\nif 未到平稳状态 then continue;\n\nif $t \\bmod M=0$ then // 采样过程, 每隔 $M$ 次采一个样本\n\n$\\mathcal{V}=\\mathcal{V} \\cup\\left\\{\\boldsymbol{x}_{t}\\right\\}$\n\nend\n\nuntil 获得 $N$ 个样本 $(|\\mathcal{V}|=N)$;\n\n输出: 样本集合 $\\mathcal{V}$\n\n该修正的马尔可夫链可以达到平稳状态, 且平稳分布为 $p(\\boldsymbol{x})$.\n\n证明. 根据马尔可夫链的细致平稳条件, 有\n\n\n\\begin{align*}\np\\left(\\boldsymbol{x}_{t}\\right) q^{\\prime}\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right) & =p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right) A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)  \\tag{11.109}\\\\\n& =p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right) \\min \\left(1, \\frac{p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right)}{p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right)}\\right)  \\tag{11.110}\\\\\n& =\\min \\left(p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right), p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right)\\right)  \\tag{11.111}\\\\\n& =p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right) \\min \\left(\\frac{p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right)}{p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right)}, 1\\right)  \\tag{11.112}\\\\\n& =p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right) A\\left(\\boldsymbol{x}_{t}, \\hat{\\boldsymbol{x}}\\right)  \\tag{11.113}\\\\\n& =p(\\hat{\\boldsymbol{x}}) q^{\\prime}\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right) . \\tag{11.114}\n\\end{align*}\n\n\n细致平稳条件参见定理D.1.\n\n因此, $p(\\boldsymbol{x})$ 是状态转移概率为 $q^{\\prime}\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right)$ 的马尔可夫链的平稳分布."
    },
    {
        "id": "chatcmpl-945GUBBVSmy6vO56URq6W3aL9VZAu",
        "choices": [
            {
                "finish_reason": "stop",
                "index": 0,
                "logprobs": null,
                "message": {
                    "content": "{\n    \"问题1\": \"Metropolis-Hastings 算法与什么方法相关？\",\n    \"回答1\": \"Metropolis-Hastings 算法是一种应用广泛的 MCMC 方法，用于从复杂的分布中进行采样。\",\n    \"问题2\": \"在 Metropolis-Hastings 算法中，如何修正提议分布以使得最终采样的分布为 $p(\\boldsymbol{x})$？\",\n    \"回答2\": \"Metropolis-Hastings 算法通过引入拒绝采样的思想来修正提议分布，使得最终采样的分布为 $p(\\boldsymbol{x})$。\",\n    \"问题3\": \"Metropolis-Hastings 算法中的接受概率 $A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)$ 是如何计算的？\",\n    \"回答3\": \"在 Metropolis-Hastings 算法中，接受概率 $A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)$ 被计算为 $\\text{min}\\big(1, \\frac{p(\\boldsymbol{\\tilde{x}}) q\\big(\\boldsymbol{x}_{t} \\text{ 在 } \\boldsymbol{\\tilde{x}}\\big)}{p\\big(\\boldsymbol{x}_{t}\\big) q\\big(\\boldsymbol{\\tilde{x}} \\text{ 在 } \\boldsymbol{x}_{t}\\big)}\\big)$。\",\n    \"问题4\": \"Metropolis-Hastings 算法的采样过程是如何描述的？\",\n    \"回答4\": \"在 Metropolis-Hastings 算法的采样过程中，首先根据提议分布随机生成一个样本，然后计算接受概率，并从 $(0,1)$ 的均匀分布中随机生成一个值 $z$。如果 $z$ 小于等于接受概率，则以该概率接受新样本作为下一次的采样样本；否则保持原样本不变。\",\n    \"问题5\": \"Metropolis-Hastings 算法修正的马尔可夫链状态转移概率是如何计算的？\",\n    \"回答5\": \"在 Metropolis-Hastings 算法中，修正的马尔可夫链状态转移概率 $q^{\\text{'}}\\big(\\boldsymbol{\\tilde{x}} \\text{ 在 } \\boldsymbol{x}_{t}\\big)$ 被计算为 $q\\big(\\boldsymbol{\\tilde{x}} \\text{ 在 } \\boldsymbol{x}_{t}\\big) A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)$。\",\n    \"问题6\": \"Metropolis-Hastings 算法如何保证修正的马尔可夫链可以达到平稳状态？\",\n    \"回答6\": \"Metropolis-Hastings 算法通过满足马尔可夫链的细致平稳条件来保证修正的马尔可夫链可以达到平稳状态，并且平稳分布为 $p(\\boldsymbol{x})$。\",\n    \"问题7\": \"Metropolis-Hastings 算法中的细致平稳条件是什么？\",\n    \"回答7\": \"Metropolis-Hastings 算法中的细致平稳条件要求满足 $p\\big(\\boldsymbol{x}_{t}\\big) q^{\\text{'}}\\big(\\boldsymbol{\\tilde{x}} \\text{ 在 } \\boldsymbol{x}_{t}\\big) = p\\big(\\boldsymbol{\\tilde{x}}\\big) q\\big(\\boldsymbol{x}_{t} \\text{ 在 } \\boldsymbol{\\tilde{x}}\\big)$。\",\n    \"问题8\": \"Metropolis-Hastings 算法在统计学中有何应用？\",\n    \"回答8\": \"Metropolis-Hastings 算法在统计学中被广泛应用于贝叶斯推断、概率建模和蒙特卡洛积分等领域，用于从复杂的分布中进行采样和模拟。\",\n    \"问题9\": \"Metropolis-Hastings 算法与哪个网站相关？\",\n    \"回答9\": \"Metropolis-Hastings 算法与 https://nndl.github.io/ 相关。\",\n    \"问题10\": \"Metropolis-Hastings 算法中的提议分布 $q\\big(\\boldsymbol{x} \\text{ 在 } \\boldsymbol{x}^{\\text{'}}\\big)$ 是什么意义？\",\n    \"回答10\": \"Metropolis-Hastings 算法中的提议分布 $q\\big(\\boldsymbol{x} \\text{ 在 } \\boldsymbol{x}^{\\text{'}}\\big)$ 是指给定当前状态 $\\boldsymbol{x}$ 时，生成下一个状态 $\\boldsymbol{x}^{\\text{'}}$ 的条件概率分布。\"\n}",
                    "role": "assistant",
                    "function_call": null,
                    "tool_calls": null
                }
            }
        ],
        "created": 1710760578,
        "model": "gpt-3.5-turbo-1106",
        "object": "chat.completion",
        "system_fingerprint": "fp_4aaaf0dc94",
        "usage": {
            "completion_tokens": 1256,
            "prompt_tokens": 4328,
            "total_tokens": 5584
        },
        "parameters": {
            "model": "gpt-3.5-turbo-1106",
            "temperature": 0.2,
            "frequency_penalty": 0.15,
            "presence_penalty": 0.15
        }
    }
]