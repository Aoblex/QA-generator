[
    {
        "strategy": "subsection",
        "source": "deeplearning",
        "title": "11.5.4.1 Metropolis-Hastings 算法",
        "content_length": 3824,
        "content": "Title: 11.5.4.1 Metropolis-Hastings 算法\nContent:\nMetropolis-Hastings 算法, 简称MH 算法, 是一种应用广泛的 MCMC 方法.假设马尔可夫链的状态转移分布 (即提议分布) $q\\left(\\boldsymbol{x} \\mid \\boldsymbol{x}^{\\prime}\\right)$ 为一个比较容易采样的分布, 其平稳分布往往不是 $p(\\boldsymbol{x})$. 为此, $\\mathrm{MH}$ 算法引入拒绝采样的思想来修正提议分布,使得最终采样的分布为 $p(\\boldsymbol{x})$.\n\n在 $\\mathrm{MH}$ 算法中, 假设第 $t$ 次采样的样本为 $\\boldsymbol{x}_{t}$, 首先根据提议分布 $q\\left(\\boldsymbol{x} \\mid \\boldsymbol{x}_{t}\\right)$ 抽取一个样本 $\\hat{\\boldsymbol{x}}$, 并以概率 $A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)$ 来接受 $\\hat{\\boldsymbol{x}}$ 作为第 $t+1$ 次的采样样本 $\\boldsymbol{x}_{t+1}$,\n\n\n\\begin{equation*}\nA\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)=\\min \\left(1, \\frac{p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right)}{p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right)}\\right) . \\tag{11.107}\n\\end{equation*}\n\n\nMH 算法的采样过程如算法11.3所示.\n\n在 $\\mathrm{MH}$ 算法中, 因为每次 $q\\left(\\boldsymbol{x} \\mid \\boldsymbol{x}_{t}\\right)$ 随机生成一个样本 $\\hat{\\boldsymbol{x}}$, 并以概率 $A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)$ 的方式接受, 所以修正的马尔可夫链状态转移概率为\n\n\n\\begin{equation*}\nq^{\\prime}\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right)=q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right) A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right), \\tag{11.108}\n\\end{equation*}\n\n\n\\href{https://nndl.github.io/}{https://nndl.github.io/}\n\n\\section*{算法 11.3 Metropolis-Hastings算法的采样过程}\n输入: 提议分布 $q\\left(\\boldsymbol{x} \\mid \\boldsymbol{x}^{\\prime}\\right)$,采样间隔 $M$,样本集合 $\\mathcal{V}=\\varnothing$;\n\n1 随机初始化 $x_{0}, t=0$;\n\n2 repeat\n\n\\section*{// 预热过程}\n根据 $q\\left(\\boldsymbol{x} \\mid \\boldsymbol{x}_{t}\\right)$ 随机生成一个样本 $\\hat{\\boldsymbol{x}}$;\n\n计算接受概率 $A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)$;\n\n从 $(0,1)$ 的均匀分布中随机生成一个值 $z$;\n\nif $z \\leq A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)$ then // 以 $A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)$ 的概率接受 $\\hat{\\boldsymbol{x}}$\n\n$x_{t+1}=\\hat{x}$\n\n\n\n$x_{t+1}=x_{t}$\n\nend\n\n$t++$;\n\nif 未到平稳状态 then continue;\n\nif $t \\bmod M=0$ then // 采样过程, 每隔 $M$ 次采一个样本\n\n$\\mathcal{V}=\\mathcal{V} \\cup\\left\\{\\boldsymbol{x}_{t}\\right\\}$\n\nend\n\nuntil 获得 $N$ 个样本 $(|\\mathcal{V}|=N)$;\n\n输出: 样本集合 $\\mathcal{V}$\n\n该修正的马尔可夫链可以达到平稳状态, 且平稳分布为 $p(\\boldsymbol{x})$.\n\n证明. 根据马尔可夫链的细致平稳条件, 有\n\n\n\\begin{align*}\np\\left(\\boldsymbol{x}_{t}\\right) q^{\\prime}\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right) & =p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right) A\\left(\\hat{\\boldsymbol{x}}, \\boldsymbol{x}_{t}\\right)  \\tag{11.109}\\\\\n& =p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right) \\min \\left(1, \\frac{p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right)}{p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right)}\\right)  \\tag{11.110}\\\\\n& =\\min \\left(p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right), p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right)\\right)  \\tag{11.111}\\\\\n& =p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right) \\min \\left(\\frac{p\\left(\\boldsymbol{x}_{t}\\right) q\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right)}{p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right)}, 1\\right)  \\tag{11.112}\\\\\n& =p(\\hat{\\boldsymbol{x}}) q\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right) A\\left(\\boldsymbol{x}_{t}, \\hat{\\boldsymbol{x}}\\right)  \\tag{11.113}\\\\\n& =p(\\hat{\\boldsymbol{x}}) q^{\\prime}\\left(\\boldsymbol{x}_{t} \\mid \\hat{\\boldsymbol{x}}\\right) . \\tag{11.114}\n\\end{align*}\n\n\n细致平稳条件参见定理D.1.\n\n因此, $p(\\boldsymbol{x})$ 是状态转移概率为 $q^{\\prime}\\left(\\hat{\\boldsymbol{x}} \\mid \\boldsymbol{x}_{t}\\right)$ 的马尔可夫链的平稳分布."
    },
    {
        "id": "chatcmpl-92zX23PJUtDOLaXgvws1dQc7vDocc",
        "choices": [
            {
                "finish_reason": "stop",
                "index": 0,
                "logprobs": null,
                "message": {
                    "content": "{\n    \"问题1\": \"Metropolis-Hastings 算法是什么？\",\n    \"回答1\": \"Metropolis-Hastings 算法（简称 MH 算法）是一种应用广泛的 MCMC 方法，用于从一个比较容易采样的分布中生成符合目标分布的样本。它通过引入拒绝采样的思想来修正提议分布，从而使得最终采样的分布符合目标分布。\",\n    \"问题2\": \"MH 算法中的接受概率 $A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)$ 是如何计算的？\",\n    \"回答2\": \"在 MH 算法中，根据提议分布 $q\\big(\\boldsymbol{x} \\big| \\boldsymbol{x}_{t}\\big)$ 随机生成一个样本 $\\boldsymbol{\\tilde{x}}$，然后计算接受概率 $A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)$ 的公式为 $A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)=\\text{min}\\big(1, \\frac{p(\\boldsymbol{\\tilde{x}}) q\\big(\\boldsymbol{x}_{t} \\big| \\boldsymbol{\\tilde{x}}\\big)}{p\\big(\\boldsymbol{x}_{t}\\big) q\\big(\\boldsymbol{\\tilde{x}} \\big| \\boldsymbol{x}_{t}\\big)}\\big)$。\",\n    \"问题3\": \"MH 算法的采样过程是怎样的？\",\n    \"回答3\": \"在 MH 算法的采样过程中，首先根据提议分布 $q\\big(\\boldsymbol{x} \\big| \\boldsymbol{x}_{t}\\big)$ 随机生成一个样本 $\\boldsymbol{\\tilde{x}}$，然后计算接受概率 $A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)$。接着从 $(0,1)$ 的均匀分布中随机生成一个值 $z$，如果 $z \\text{小于等于} A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)$，则以 $A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)$ 的概率接受 $\\boldsymbol{\\tilde{x}}$ 作为下一次的采样样本 $\\boldsymbol{x}_{t+1}$。\",\n    \"问题4\": \"MH 算法修正的马尔可夫链状态转移概率是如何计算的？\",\n    \"回答4\": \"在 MH 算法中，由于每次 $q\\big(\\boldsymbol{x} \\big| \\boldsymbol{x}_{t}\\big)$ 随机生成一个样本 $\\boldsymbol{\\tilde{x}}$ 并以概率 $A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)$ 的方式接受，所以修正的马尔可夫链状态转移概率为 $q^{\\text{'}}\\big(\\boldsymbol{\\tilde{x}} \\big| \\boldsymbol{x}_{t}\\big)=q\\big(\\boldsymbol{\\tilde{x}} \\big| \\boldsymbol{x}_{t}\\big) A\\big(\\boldsymbol{\\tilde{x}}, \\boldsymbol{x}_{t}\\big)$。\",\n    \"问题5\": \"MH 算法修正的马尔可夫链能否达到平稳状态？\",\n    \"回答5\": \"是的，MH 算法修正的马尔可夫链可以达到平稳状态，并且其平稳分布为目标分布 $p(\\boldsymbol{x})$。\",\n    \"问题6\": \"Metropolis-Hastings 算法与哪个领域密切相关？\",\n    \"回答6\": \"Metropolis-Hastings 算法与马尔可夫链 Monte Carlo（MCMC）方法密切相关。它是 MCMC 方法中的一种重要算法，用于从一个比较容易采样的分布中生成符合目标分布的样本。\",\n    \"问题7\": \"Metropolis-Hastings 算法的输入参数有哪些？\",\n    \"回答7\": \"Metropolis-Hastings 算法的输入参数包括提议分布 $q\\big(\\boldsymbol{x} \\big| \\boldsymbol{x}^{\\text{'}}\\big)$、采样间隔 $M$ 和样本集合 $\\text{V}=\\text{∅}$。\",\n    \"问题8\": \"Metropolis-Hastings 算法中的预热过程是指什么？\",\n    \"回答8\": \"在 Metropolis-Hastings 算法中，预热过程是指在开始进行实际采样之前，通过随机生成样本并计算接受概率来初始化和准备马尔可夫链状态转移过程。这个过程有助于使得马尔可夫链达到平稳状态并得到符合目标分布的样本。\",\n    \"问题9\": \"Metropolis-Hastings 算法如何保证最终采样的分布为目标分布？\",\n    \"回答9\": \"Metropolis-Hastings 算法通过引入拒绝采样的思想来修正提议分布，使得最终采样的分布符合目标分布。通过计算接受概率并根据一定规则接受或拒绝新生成的样本，最终可以得到符合目标分布的样本集合。\",\n    \"问题10\": \"Metropolis-Hastings 算法如何证明修正的马尔可夫链可以达到平稳状态？\",\n    \"回答10\": \"Metropolis-Hastings 算法通过马尔可夫链的细致平稳条件来证明修正的马尔可夫链可以达到平稳状态。根据细致平稳条件，可以推导出修正后的马尔可夫链的平稳分布为目标分布。\"\n}",
                    "role": "assistant",
                    "function_call": null,
                    "tool_calls": null
                }
            }
        ],
        "created": 1710500212,
        "model": "gpt-3.5-turbo-1106",
        "object": "chat.completion",
        "system_fingerprint": "fp_4aaaf0dc94",
        "usage": {
            "completion_tokens": 1565,
            "prompt_tokens": 4266,
            "total_tokens": 5831
        },
        "parameters": {
            "model": "gpt-3.5-turbo-1106",
            "temperature": 0.2,
            "frequency_penalty": 0.15,
            "presence_penalty": 0.15
        }
    }
]