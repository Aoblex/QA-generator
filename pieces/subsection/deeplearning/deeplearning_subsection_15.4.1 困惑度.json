[
    {
        "strategy": "subsection",
        "source": "deeplearning",
        "title": "15.4.1 困惑度",
        "content_length": 2118,
        "content": "Title: 15.4.1 困惑度\nContent:\n给定一个测试文本集合，一个好的序列生成模型应该使得测试集合中句子的联合概率尽可能高.\n\n困惑度 (Perplexity) 是信息论中的一个概念, 可以用来衡量一个分布的不确定性. 对于离散随机变量 $X \\in \\mathcal{X}$, 其概率分布为 $p(x)$,困惑度为\n\n\n\\begin{equation*}\n2^{\\boldsymbol{H}(p)}=2^{-\\sum_{x \\in x} p(x) \\log _{2} p(x)}, \\tag{15.33}\n\\end{equation*}\n\n\n其中 $\\boldsymbol{H}(p)$ 为分布 $p$ 的熵.\n\n困惑度也可以用来衡量两个分布之间差异. 对于一个未知的数据分布 $p_{r}(x)$和一个模型分布 $p_{\\theta}(x)$, 我们从 $p_{r}(x)$ 中采样出一组测试样本 $x^{(1)}, \\cdots, x^{(N)}$, 模型分布 $p_{\\theta}(x)$ 的困惑度为\n\n\n\\begin{equation*}\n2^{H\\left(\\tilde{p}_{r}, p_{\\theta}\\right)}=2^{-\\frac{1}{N} \\sum_{n=1}^{N} \\log _{2} p_{\\theta}\\left(x^{(n)}\\right)}, \\tag{15.34}\n\\end{equation*}\n\n\n其中 $\\boldsymbol{H}\\left(\\tilde{p}_{r}, p_{\\theta}\\right)$ 为样本的经验分布 $\\tilde{p}_{r}$ 与模型分布 $p_{\\theta}$ 之间的交叉熵, 也是所有样本上的负对数似然函数.\n\n困惑度可以衡量模型分布与样本经验分布之间的契合程度. 困惑度越低则两个分布越接近. 因此,模型分布 $p_{\\theta}(x)$ 的好坏可以用困惑度来评价.\\\\\n假设测试集合有 $N$ 个独立同分布的序列 $\\left\\{\\boldsymbol{x}_{1: T_{n}}^{(n)}\\right\\}_{n=1}^{N}$. 我们可以用模型 $p_{\\theta}(\\boldsymbol{x})$对每个序列计算其概率 $p_{\\theta}\\left(\\boldsymbol{x}_{1: T_{n}}^{(n)}\\right)$, 整个测试集的联合概率为\n\n\n\\begin{equation*}\n\\prod_{n=1}^{N} p_{\\theta}\\left(\\boldsymbol{x}_{1: T_{n}}^{(n)}\\right)=\\prod_{n=1}^{N} \\prod_{t=1}^{T_{n}} p_{\\theta}\\left(x_{t}^{(n)} \\mid \\boldsymbol{x}_{1:(t-1)}^{(n)}\\right) \\tag{15.35}\n\\end{equation*}\n\n\n模型 $p_{\\theta}(\\boldsymbol{x})$ 的困惑度定义为\n\n\n\\begin{align*}\n\\operatorname{PPL}(\\theta) & =2^{-\\frac{1}{T} \\sum_{n=1}^{N} \\log _{2} p_{\\theta}\\left(\\boldsymbol{x}_{1: T_{n}}^{(n)}\\right)}  \\tag{15.36}\\\\\n& =2^{-\\frac{1}{T} \\sum_{n=1}^{N} \\sum_{t=1}^{T_{n}} \\log _{2} p_{\\theta}\\left(x_{t}^{(n)} \\mid \\boldsymbol{x}_{1:(t-1)}^{(n)}\\right)}  \\tag{15.37}\\\\\n& =\\left(\\prod_{n=1}^{N} \\prod_{t=1}^{T_{n}} p_{\\theta}\\left(x_{t}^{(n)} \\mid \\boldsymbol{x}_{1:(t-1)}^{(n)}\\right)\\right)^{-1 / T} \\tag{15.38}\n\\end{align*}\n\n\n其中 $T=\\sum_{n=1}^{N} T_{n}$ 为测试数据集中序列的总长度. 可以看出, 困惑度为每个词条件概率 $p_{\\theta}\\left(x_{t}^{(n)} \\mid x_{1:(t-1)}^{(n)}\\right)$ 的几何平均数的倒数. 测试集中所有序列的概率越大,困惑度越小,模型越好.\n\n假设一个序列模型赋予每个词出现的概率均等, 即 $p_{\\theta}\\left(x_{t}^{(n)} \\mid x_{1:(t-1)}^{(n)}\\right)=\\frac{1}{|\\mathcal{V}|}$,则该模型的困惑度为 $|\\mathcal{V}|$. 以英语为例, $\\mathrm{N}$ 元模型的困惑度范围一般为 $50 \\sim 1000$."
    },
    {
        "id": "chatcmpl-946WB4nYLsi8ntT0JhZRuEE0krrdN",
        "choices": [
            {
                "finish_reason": "stop",
                "index": 0,
                "logprobs": null,
                "message": {
                    "content": "{\n    \"问题1\": \"困惑度（Perplexity）在信息论中是用来衡量什么的？\",\n    \"回答1\": \"困惑度（Perplexity）在信息论中是用来衡量一个分布的不确定性的，对于离散随机变量 $X \\text{ 且 } X \\text{ 在 } \\boldsymbol{\\text{X}}$ 中，其概率分布为 $p(x)$。困惑度可以用来衡量该分布的不确定性程度。\",\n    \"问题2\": \"困惑度的计算公式是什么？\",\n    \"回答2\": \"困惑度的计算公式为 $2^{\\boldsymbol{H}(p)}=2^{-\\text{在 } x \\text{ 中求和} p(x) \\text{ 乘以 } \\boldsymbol{\\text{log}}_{2} p(x)}$，其中 $\\boldsymbol{H}(p)$ 为分布 $p$ 的熵。\",\n    \"问题3\": \"困惑度如何衡量两个分布之间的差异？\",\n    \"回答3\": \"对于一个未知的数据分布 $p_{r}(x)$ 和一个模型分布 $p_{\\theta}(x)$，困惑度可以通过计算样本的经验分布 $\\tilde{p}_{r}$ 与模型分布 $p_{\\theta}$ 之间的交叉熵来衡量两个分布之间的差异。\",\n    \"问题4\": \"困惑度越低代表什么？\",\n    \"回答4\": \"困惑度越低代表模型分布与样本经验分布之间越接近。因此，困惑度越低则代表模型的好坏程度越好。\",\n    \"问题5\": \"如何计算模型的困惑度？\",\n    \"回答5\": \"模型 $p_{\\theta}(\\boldsymbol{x})$ 的困惑度定义为 $2^{-\\frac{1}{T} \\text{在 } n=1 \\text{ 到 } N \\text{ 求和} \\boldsymbol{\\text{log}}_{2} p_{\\theta}\\big(\\boldsymbol{x}_{1: T_{n}}^{(n)}\\big)}$，其中 $T=\\text{在 } n=1 \\text{ 到 } N \\text{ 求和} T_{n}$ 为测试数据集中序列的总长度。\",\n    \"问题6\": \"困惑度的倒数表示什么含义？\",\n    \"回答6\": \"困惑度的倒数表示每个词条件概率 $p_{\\theta}\\big(x_{t}^{(n)} \\big| x_{1:(t-1)}^{(n)}\\big)$ 的几何平均数。测试集中所有序列的概率越大，困惑度越小，模型越好。\",\n    \"问题7\": \"困惑度为 $|\\boldsymbol{\\text{V}}|$ 时表示什么情况？\",\n    \"回答7\": \"当一个序列模型赋予每个词出现的概率均等时，即 $p_{\\theta}\\big(x_{t}^{(n)} \\big| x_{1:(t-1)}^{(n)}\\big)=\\frac{1}{|\\boldsymbol{\\text{V}}|}$，则该模型的困惑度为 $|\\boldsymbol{\\text{V}}|$。以英语为例，$\\text{N 元模型的困惑度范围一般为 } 50 \\text{ 到 } 1000$。\",\n    \"问题8\": \"什么是测试集合中句子的联合概率？\",\n    \"回答8\": \"测试集合中句子的联合概率是指对于一个测试集合中有 $N$ 个独立同分布的序列 $\\big\\big\\boldsymbol{x}_{1: T_{n}}^{(n)}\\big\\big)_{n=1}^{N}$，使用模型 $p_{\\theta}(\\boldsymbol{x})$ 对每个序列计算其概率 $p_{\\theta}\\big(\\boldsymbol{x}_{1: T_{n}}^{(n)}\\big)$，然后计算整个测试集的联合概率。\",\n    \"问题9\": \"模型困惑度如何定义？\",\n    \"回答9\": \"模型 $p_{\\theta}(\\boldsymbol{x})$ 的困惑度定义为 $\\text{在 } n=1 \\text{ 到 } N \\text{ 求和} \\frac{1}{T} \\boldsymbol{\\text{log}}_{2} p_{\\theta}\\big(\\boldsymbol{x}_{1: T_{n}}^{(n)}\\big)$。\"\n}",
                    "role": "assistant",
                    "function_call": null,
                    "tool_calls": null
                }
            }
        ],
        "created": 1710765395,
        "model": "gpt-3.5-turbo-1106",
        "object": "chat.completion",
        "system_fingerprint": "fp_4aaaf0dc94",
        "usage": {
            "completion_tokens": 1217,
            "prompt_tokens": 3861,
            "total_tokens": 5078
        },
        "parameters": {
            "model": "gpt-3.5-turbo-1106",
            "temperature": 0.2,
            "frequency_penalty": 0.15,
            "presence_penalty": 0.15
        }
    }
]