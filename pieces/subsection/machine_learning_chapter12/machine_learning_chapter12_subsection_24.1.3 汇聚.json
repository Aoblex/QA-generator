[
    {
        "strategy": "subsection",
        "source": "machine_learning_chapter12",
        "title": "24.1.3 汇聚",
        "content_length": 3982,
        "content": "Title: 24.1.3 汇聚\nContent:\n卷积神经网络还使用汇聚 (pooling) 运算。\n\n\\section*{1. 二维汇聚}\n定义 24.2 (二维汇聚) 给定一个 $I \\times J$ 输入矩阵 $\\boldsymbol{X}=\\left[x_{i j}\\right]_{I \\times J}$, 一个虚设的 $M \\times N$ 核矩阵, $M \\ll I, N \\ll J$ 。让核矩阵在输入矩阵上从左到右再从上到下滑动, 将输入矩阵划分成若千大小为 $M \\times N$ 的子矩阵, 这些子矩阵相互不重叠且完全覆盖整个输入矩阵。对每一个子矩阵求最大值或平均值, 产生一个 $K \\times L$ 输出矩阵 $\\boldsymbol{Y}=\\left[y_{k l}\\right]_{K \\times L}$, 称此运算为汇聚或二维汇聚。对子矩阵取最大值的称为最大汇聚 (max pooling), 取平均值的称为平均汇聚 (mean pooling )。即有\n\n\n\\begin{equation*}\ny_{k l}=\\max _{m \\in\\{1,2, \\cdots, M\\}, n \\in\\{1,2, \\cdots N\\}} x_{k+m-1, l+n-1} \\tag{24.8}\n\\end{equation*}\n\n\n或\n\n\n\\begin{equation*}\ny_{k l}=\\frac{1}{M N} \\sum_{m=1}^{M} \\sum_{n=1}^{N} x_{k+m-1, l+n-1} \\tag{24.9}\n\\end{equation*}\n\n\n其中, $k=1,2, \\cdots, K, l=1,2, \\cdots, L, K$ 和 $L$ 满足\n\n$$\nK=\\frac{I}{M}, \\quad L=\\frac{J}{N}\n$$\n\n这里假设 $I$ 和 $J$ 分别可以被 $M$ 和 $N$ 整除。\n\n以上是基本汇聚的定义, 还有多种扩展。在汇聚运算中, 核矩阵每次向右或向下移动的列数或行数也称为步幅。通常汇聚的步幅与核的大小相同。汇聚运算也可以进行填充, 即在输入矩阵的周边添加元素为 0 的行和列。汇聚运算依赖于核的大小、填充的大小和步幅, 也就是说, 这些都是超参数。\n\n汇聚也称为下采样 (down sampling), 因为通过汇聚数据矩阵的大小变小。相反, 使数据\\\\\n矩阵变大的运算称为上采样 (upsampling)。\n\n比较式 (24.5) 和式 (24.9) 容易看出, 平均汇聚是卷积的一种特殊情况, 其参数个数为 0 。\n\n例 24.7 给定输入矩阵 $\\boldsymbol{X}$ :\n\n$$\n\\boldsymbol{X}=\\left[\\begin{array}{llll}\n3 & 2 & 0 & 1 \\\\\n0 & 2 & 1 & 2 \\\\\n2 & 0 & 0 & 3 \\\\\n2 & 3 & 1 & 2\n\\end{array}\\right]\n$$\n\n核的大小为 $2 \\times 2$, 步幅为 2 。求 $\\boldsymbol{X}$ 上的最大汇聚。\n\n解 按照式 (24.8) 计算得到最大汇聚的输出矩阵 $\\boldsymbol{Y}$ :\n\n$$\n\\boldsymbol{Y}=\\left[\\begin{array}{ll}\n3 & 2 \\\\\n3 & 3\n\\end{array}\\right]\n$$\n\n图 24.8 示意最大汇聚的计算过程。\\\\\n\\includegraphics[max width=\\textwidth, center]{2024_03_13_fc25db59b1a18f350d07g-08(2)}\n\n\\begin{center}\n\\begin{tabular}{|l|l|}\n\\hline\n3 & 2 \\\\\n\\hline\n3 &  \\\\\n\\hline\n\\end{tabular}\n\\end{center}\n\n\\begin{center}\n\\includegraphics[max width=\\textwidth]{2024_03_13_fc25db59b1a18f350d07g-08(1)}\n\\end{center}\n\n图 24.8 最大汇聚计算例\n\n例 24.8 对于与例 24.7 相同的输入矩阵 $\\boldsymbol{X}$, 核的大小为 $2 \\times 2$, 步幅为 2 , 求 $\\boldsymbol{X}$ 上的平均汇聚。\n\n解 按照式 (24.9) 计算得到平均汇聚的输出矩阵 $\\boldsymbol{Y}$ :\n\n$$\n\\boldsymbol{Y}=\\left[\\begin{array}{ll}\n1.75 & 1 \\\\\n1.75 & 1.5\n\\end{array}\\right]\n$$\n\n图 24.9 示意平均汇聚计算的一步。\n\n\\begin{center}\n\\includegraphics[max width=\\textwidth]{2024_03_13_fc25db59b1a18f350d07g-08}\n\\end{center}\n\n图 24.9 平均汇聚计算例\\\\\n在图像处理中, 汇聚实现的是特征选择。最基本的情况是二维汇聚, 输入是一个矩阵, 矩阵的一个元素表示一个特征, 代表特征的检测值。汇聚运算实际是将汇聚核在输入矩阵上进行滑动, 从汇聚核覆盖的特征检测值中选择一个最大值或平均值, 这样可以有效地进行特征抽取。输出是一个缩小的矩阵, 也就是进行了下采样。\n\n\\section*{2. 三维汇聚}\n三维汇聚的输入和输出都是张量表示的特征图。汇聚对输入张量的各个矩阵分别进行汇聚计算, 再将结果排列起来, 产生输出张量。汇聚的输入特征图和输出特征图的深度相同, 输出特征图比输入特征图有更小的高度和宽度。\n\n例 24.9 对于例 24.6 的输入张量, 核的大小为 $2 \\times 2$, 步幅为 2 , 求 $\\boldsymbol{X}$ 上的三维最大汇聚。\n\n解 对各个矩阵分别按照式 (24.8) 计算, 可得输出张量 $\\boldsymbol{Y}$ :\n\n$$\n\\begin{aligned}\n\\boldsymbol{Y} & =\\text { pooling }\\left(\\left[\\begin{array}{llll}\n3 & 2 & 0 & 1 \\\\\n0 & 2 & 1 & 2 \\\\\n2 & 0 & 0 & 3 \\\\\n2 & 3 & 1 & 2\n\\end{array}\\right],\\left[\\begin{array}{llll}\n3 & 2 & 0 & 1 \\\\\n2 & 1 & 0 & 1 \\\\\n1 & 0 & 2 & 1 \\\\\n2 & 1 & 0 & 0\n\\end{array}\\right],\\left[\\begin{array}{llll}\n4 & 2 & 0 & 1 \\\\\n0 & 3 & 1 & 0 \\\\\n3 & 1 & 0 & 2 \\\\\n2 & 2 & 0 & 1\n\\end{array}\\right]\\right) \\\\\n& =\\left(\\left[\\begin{array}{ll}\n3 & 2 \\\\\n3 & 3\n\\end{array}\\right],\\left[\\begin{array}{ll}\n3 & 1 \\\\\n2 & 2\n\\end{array}\\right],\\left[\\begin{array}{ll}\n4 & 1 \\\\\n3 & 2\n\\end{array}\\right]\\right)\n\\end{aligned}\n$$\n\n输出特征图 (输出张量) 是一个 $2 \\times 2 \\times 3$ 张量。输入特征图和输出特征图的深度都是 3 。输入特征图高度和宽度都是 4 , 而输出特征图的高度和宽度都是 2 。图 24.10 示意三维最大汇聚计算的一步。\n\n\\begin{center}\n\\includegraphics[max width=\\textwidth]{2024_03_13_fc25db59b1a18f350d07g-09(2)}\n\\end{center}\n\n\\begin{center}\n\\begin{tabular}{|l|l|l|l|}\n\\hline\n4 & 2 & 0 & 1 \\\\\n\\hline\n0 & 3 & 1 & 0 \\\\\n\\hline\n3 & 1 & 0 & 2 \\\\\n\\hline\n2 & 2 & 0 & 1 \\\\\n\\hline\n\\end{tabular}\n\\end{center}\n\n\\begin{center}\n\\includegraphics[max width=\\textwidth]{2024_03_13_fc25db59b1a18f350d07g-09}\n\\end{center}\n\n\\begin{center}\n\\begin{tabular}{|l|l|l|l|}\n\\hline\n3 & 2 & 0 & 1 \\\\\n\\hline\n0 & 2 & 1 & 2 \\\\\n\\hline\n2 & 0 & 0 & 3 \\\\\n\\hline\n2 & 3 & 1 & 2 \\\\\n\\hline\n\\end{tabular}\n\\end{center}\n\n\\begin{center}\n\\includegraphics[max width=\\textwidth]{2024_03_13_fc25db59b1a18f350d07g-09(1)}\n\\end{center}\n\n三维最大汇聚计算例"
    },
    {
        "id": "chatcmpl-93w0Oxp1zEJFS4MOQMaoqBh5zLFPN",
        "choices": [
            {
                "finish_reason": "stop",
                "index": 0,
                "logprobs": null,
                "message": {
                    "content": "{\n    \"问题1\": \"汇聚运算的基本定义是什么？\",\n    \"回答1\": \"汇聚运算是指在输入矩阵上使用虚设的核矩阵进行滑动，将输入矩阵划分成若干大小为 $M \\times N$ 的子矩阵，对每一个子矩阵求最大值或平均值，产生一个 $K \\times L$ 输出矩阵。这些子矩阵相互不重叠且完全覆盖整个输入矩阵。对子矩阵取最大值的称为最大汇聚（max pooling），取平均值的称为平均汇聚（mean pooling）。汇聚运算也可以进行填充，即在输入矩阵的周边添加元素为 0 的行和列。\",\n    \"问题2\": \"二维汇聚中的最大汇聚和平均汇聚分别是如何计算的？\",\n    \"回答2\": \"在二维汇聚中，最大汇聚的计算公式为 $y_{k l}=\\text{max}_{m \\text{ 在 } \\big\\brace{1,2, \\text{...}, M}, n \\text{ 在 } \\big\\brace{1,2, \\text{...} N}} x_{k+m-1, l+n-1}$，而平均汇聚的计算公式为 $y_{k l}=\\frac{1}{M N} \\text{sum}_{m=1}^{M} \\text{sum}_{n=1}^{N} x_{k+m-1, l+n-1}$。\",\n    \"问题3\": \"汇聚运算中的步幅和填充分别指什么？\",\n    \"回答3\": \"在汇聚运算中，步幅指的是核矩阵每次向右或向下移动的列数或行数。通常汇聚的步幅与核的大小相同。而填充是指在输入矩阵的周边添加元素为 0 的行和列，用于调整输出矩阵的大小。\",\n    \"问题4\": \"汇聚运算中的超参数有哪些？\",\n    \"回答4\": \"汇聚运算依赖于核的大小、填充的大小和步幅，这些都是超参数。核的大小决定了每次滑动时覆盖的区域大小，填充的大小影响输出矩阵的大小，而步幅则决定了每次滑动的距离。\",\n    \"问题5\": \"在图像处理中，汇聚运算实现了什么功能？\",\n    \"回答5\": \"在图像处理中，汇聚运算实现了特征选择。通过将汇聚核在输入矩阵上进行滑动，从覆盖的特征检测值中选择一个最大值或平均值，可以有效地进行特征抽取。输出是一个缩小的矩阵，也就是进行了下采样。\",\n    \"问题6\": \"三维汇聚与二维汇聚有何区别？\",\n    \"回答6\": \"三维汇聚的输入和输出都是张量表示的特征图，对输入张量的各个矩阵分别进行汇聚计算，再将结果排列起来产生输出张量。三维汇聚与二维汇聚相比，处理的对象更加复杂，输出特征图比输入特征图有更小的高度和宽度。\",\n    \"问题7\": \"如何计算三维最大汇聚？\",\n    \"回答7\": \"对于三维最大汇聚，在每个矩阵上按照最大汇聚的计算公式进行计算，然后将结果排列起来形成输出张量。这样可以得到输出特征图（输出张量），其深度和高度宽度都会发生变化。\",\n    \"问题8\": \"例24.7中给定输入矩阵 $\\boldsymbol{X}$ 上的最大汇聚结果是什么？\",\n    \"回答8\": \"例24.7中给定输入矩阵 $\\boldsymbol{X}$ 上的最大汇聚结果为 $\\boldsymbol{Y}=\\big[\\big[3, 2\\big], \\big[3, 3\\big]\\big]$。\",\n    \"问题9\": \"例24.8中给定输入矩阵 $\\boldsymbol{X}$ 上的平均汇聚结果是什么？\",\n    \"回答9\": \"例24.8中给定输入矩阵 $\\boldsymbol{X}$ 上的平均汇聚结果为 $\\boldsymbol{Y}=\\big[\\big[1.75, 1\\big], \\big[1.75, 1.5\\big]\\big]$。\",\n    \"问题10\": \"例24.9中给定输入张量上的三维最大汇聚结果是什么？\",\n    \"回答10\": \"例24.9中给定输入张量上的三维最大汇聚结果为 $\\boldsymbol{Y}=\\big[\\big[3, 2\\big], \\big[3, 3\\big]\\big], \\big[\\big[3, 1\\big], \\big[2, 2\\big]\\big], \\big[\\big[4, 1\\big], \\big[3, 2\\big]\\big]$。\"\n}",
                    "role": "assistant",
                    "function_call": null,
                    "tool_calls": null
                }
            }
        ],
        "created": 1710724984,
        "model": "gpt-3.5-turbo-1106",
        "object": "chat.completion",
        "system_fingerprint": "fp_4aaaf0dc94",
        "usage": {
            "completion_tokens": 1455,
            "prompt_tokens": 5115,
            "total_tokens": 6570
        },
        "parameters": {
            "model": "gpt-3.5-turbo-1106",
            "temperature": 0.2,
            "frequency_penalty": 0.15,
            "presence_penalty": 0.15
        }
    }
]